<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pencarian Data VKRN</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.min.js"></script>
    <style>
        * { box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        body { margin: 0; padding: 20px; background-color: #f5f5f5; }
        .container { max-width: 700px; margin: 0 auto; background-color: white; padding: 32px; border-radius: 10px; box-shadow: 0 2px 10px rgba(0,0,0,0.05);}
        h1 { text-align: center; color: #2c3e50; margin-bottom: 30px;}
        form { display: flex; flex-direction: column; gap: 16px; margin-bottom: 24px;}
        input[type="file"], input[type="text"] { padding: 8px; border: 1px solid #ccc; border-radius: 6px;}
        button { padding: 10px; background: #2980b9; color: #fff; border: none; border-radius: 6px; cursor: pointer; font-weight: bold;}
        button:hover { background: #3498db;}
        #results { margin-top: 24px; }
        .result-item { padding: 12px; border-bottom: 1px solid #eee; }
        .result-highlight { background: #ffe066; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Pencarian Data VKRN (PDF)</h1>
        <form id="searchForm">
            <input type="file" id="pdfFile" accept="application/pdf" required>
            <input type="text" id="searchText" placeholder="Cari kata/frasa..." required>
            <button type="submit">Cari dalam PDF</button>
        </form>
        <div id="results"></div>
    </div>
    <script>
        const pdfjsLib = window['pdfjs-dist/build/pdf'];
        pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.11.174/pdf.worker.min.js';

        document.getElementById('searchForm').addEventListener('submit', async function(event) {
            event.preventDefault();
            const fileInput = document.getElementById('pdfFile');
            const searchText = document.getElementById('searchText').value.trim();
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<em>Mencari...</em>';

            if (!fileInput.files[0] || !searchText) {
                resultsDiv.innerHTML = '<span style="color:red;">File PDF dan kata pencarian wajib diisi.</span>';
                return;
            }

            // Read PDF as ArrayBuffer
            const file = fileInput.files[0];
            const arrayBuffer = await file.arrayBuffer();

            // Load PDF
            const pdfDoc = await pdfjsLib.getDocument({data: arrayBuffer}).promise;
            let results = [];
            for (let i = 1; i <= pdfDoc.numPages; i++) {
                const page = await pdfDoc.getPage(i);
                const content = await page.getTextContent();
                const texts = content.items.map(item => item.str).join(' ');
                if (texts.toLowerCase().includes(searchText.toLowerCase())) {
                    // Highlight search result
                    const regex = new RegExp(searchText, 'gi');
                    const highlighted = texts.replace(regex, match => `<span class="result-highlight">${match}</span>`);
                    results.push(`<div class="result-item"><b>Halaman ${i}:</b><br>${highlighted}</div>`);
                }
            }

            if (results.length > 0) {
                resultsDiv.innerHTML = results.join('');
            } else {
                resultsDiv.innerHTML = '<em>Tidak ditemukan hasil pada file PDF.</em>';
            }
        });
    </script>
</body>
</html>
